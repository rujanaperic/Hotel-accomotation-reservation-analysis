---
title: "Analiza rezervacija hotelskog smještaja"
subtitle: "Grupa Prosječni"
author: "Mario Mrvčić, Rujana Perić, Dorjan Štrbac, Sven Winkler"
output: pdf_document
date: "2023-12-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## OPIS ZADATKA

U današnje vrijeme turistička djelatnost jako je popularna, a tržište puno konkurencije. Zanima nas kako hoteli mogu prilagoditi svoje usluge kako bi poboljšali zadovoljnost gostiju i povećali profitabilnost. 

Posjedujući skup podataka koji detaljno dokumentira rezervacije u dva različita hotela želimo istražiti, bolje razumjeti i ispitati veze između boravka u hotelu, godišnjeg doba, socio-ekonomskog statusa gosta, cijena, tipa rezervacija i sličnih parametara danih skupom podataka. 

## Učitavanje podataka o rezervacijama 

Skup podataka sastoji se od 119390 podataka o rezervacijama u dva hotela. Svaki podatak o rezervaciji sastoji se od 31 varijable koje pružaju uvid u trendove dolaska, demografske podatke gostiju, njihove financijske obrasce... 

U nastavku je prikazan: 

- podatak o broju zapisa rezervacija 
```{r h1 data, h2 data, combined}
h1_data = read.csv("Rezervacije/Rezervacije_/H1.csv")
h2_data = read.csv("Rezervacije/Rezervacije_/H2.csv")
data <- rbind(h1_data, h2_data)
dim(data)
``` 

- primjer nekoliko zapisa
``` {r}
head(data)
```
- svi parametri rezervacija 
``` {r}
names(data)
```
\newpage

# Case study: TRAJANJE BORAVKA GOSTA 

Slijedi detaljna analiza trajanja boravka gosta s obrizom na različite parametre. 

## Trajanje prosječnog boravka tjekom različitih godišnjih doba

Dogovorno su godišnja doba definirana na idući način: \    
ljeto - lipanj, srpanj, kolovoz \    
jesen - rujan, listopad, studeni \   
zima - prosinac, siječanj, veljača \   
proljeće -ožujak, travanj, svibanj

Definiramo čeriti pomoćna skupa podataka za svako godišnje doba grupirajući po paramteru "ArrivalDateMonth".

```{r data by season}
summer = rbind(data[data$ArrivalDateMonth == "June",], 
               data[data$ArrivalDateMonth == "July",], 
               data[data$ArrivalDateMonth == "August",])

autumn = rbind(data[data$ArrivalDateMonth == "September",], 
               data[data$ArrivalDateMonth == "October",], 
               data[data$ArrivalDateMonth == "November",])

winter = rbind(data[data$ArrivalDateMonth == "December",], 
               data[data$ArrivalDateMonth == "January",], 
               data[data$ArrivalDateMonth == "February",])

spring = rbind(data[data$ArrivalDateMonth == "March",], 
               data[data$ArrivalDateMonth == "April",], 
               data[data$ArrivalDateMonth == "May",])
```

Pomoćnim skupovima dodajemo i parametar "TotalStays" koji predstavlja sumu vrijednosti parametara "StaysInWeekendNights" i "StaysInWeekNights" kako bismo dobili uvid o trajanju boravka gosta neovisno o danima u tjednu. 

```{r data by season, total stays}
library(magrittr)
library(dplyr)

summer_total <- summer %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)

autumn_total <- autumn %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)

winter_total <- winter %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)

spring_total <- spring %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)
```
Računamo prosječnu duljinu trajanja boravka za svaki pomoćni skup podataka, rezultat prikazujemo stupičastim dijagramom.  

```{r means by seasons data}

seasons_means_vector = data.frame(
  Season = c("Winter", "Spring", "Summer", "Autumn"), 
  Means = c(mean(winter_total$TotalStays), 
            mean(spring_total$TotalStays), 
            mean(summer_total$TotalStays), 
            mean(autumn_total$TotalStays))
)

barplot(seasons_means_vector$Means, names.arg = seasons_means_vector$Season, col = "skyblue", xlab = "Seasons", ylab = "Average night stays")

#binding adjusted data
data_total_stays = rbind(winter_total, spring_total, summer_total, autumn_total)
```
Iz histograma možemo zaključiti da je prosječni boravak gostiju najduži ljeti, a najkraći zimi. 

## Trajanje prosječnog boravka i tip iznajmljene sobe

Naše istraživačko pitanje je slijedeće: \   
Možemo li trajanje boravka povezati s tipom iznajmljene sobe?

Pogledajmo najprije koje sve kategorije soba za iznajmljivanje postoje.

```{r}
#all different values of "ReservedRoomType" variable
room_types = unique(data_total_stays$AssignedRoomType)
room_types
```
Iz priloženog možemo vidjeti da postoji 12 različitih kategorija soba, prema tome, uzimamo 12 podskupova podataka i uspoređujemo njihove aritmetičke sredine duljine trajanja boravka (varijabla "TotayStays").  

Za dati odgovor na istraživačko pitanje koristit ćemo se jednofaktorskim ANOVA modelom.

Predpostavke ANOVE su: \ 
- nezavisnost pojedinih podataka u uzorcima \  
- normalna razdioba podataka \ 
- homogenost varijanci među populacijama \ 

Kako nam veličine grupa nisu podjednake, radimo provjeru normalnosti Lillieforsovom inačicom Kolmogorov-Smirnovljenog testa. 
Razmatrat ćemo tip sobe kao varijablu koja određuje grupe i ukupnu duljinu boravka kao zavisnu varijablu. 

```{r test predpostavki - normalnost}
require(nortest)

lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "I               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "A               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "E               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "D               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "F               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "C               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "H               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "G               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "P               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "B               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "K               ", ]$TotalStays)
```
Iznimno malene p-vrijednosti nam govore kako podaci nisu normalno distribuirani.\ 
Usprkos tome, jednofaktorska ANOVA je robusna statistika s obzirom na predpostavku normalnosti. Dobro tolerira odstupanja od normalne distribucije. 

Što se tiče homogenosti varijanci različitih populacija, potrebno je testirati:
$$ \begin{aligned}
  H_0 & : \sigma_1^2 = \sigma_2^2 = \ldots = \sigma_k^2 \\
  H_1 & : \text{barem dvije varijance nisu iste}.
\end{aligned} $$
Navedenu hipotezu možemo testirati Bartlettovim testom. 

```{r test pretpostavki - homogenost varijanci}

data_total_stays$AssignedRoomType <- factor(data_total_stays$AssignedRoomType)

# Check the number of observations in each group
group_counts <- table(data_total_stays$AssignedRoomType)
valid_groups <- names(group_counts[group_counts >= 2])

#If there is at least two oservations in the group, proceed
filtered_data <- subset(data_total_stays, AssignedRoomType %in% valid_groups)

#Bartlettovim test
bartlett.test(filtered_data$TotalStays ~ filtered_data$AssignedRoomType)
```
Varijance varijable "TotalStays" nisu podjednake, što je grafički prikazano u nastavku. 

```{r plotting}
#box and whisker plot --> mean, rangs, median, variances....
library(ggplot2)

# Assuming filtered_data$AssignedRoomType is a factor
filtered_data$AssignedRoomType <- factor(filtered_data$AssignedRoomType)

# Create a boxplot using ggplot2
ggplot(filtered_data, aes(x = AssignedRoomType, y = TotalStays)) +
  geom_boxplot(fill = "skyblue", color = "black") +
  labs(title = "Total Stays by Assigned Room Type",
       x = "Assigned Room Type",
       y = "Total Stays") +
  theme_minimal()
```


Dani podaci o distibuciji koja nije normalna i nehomogenosti varijanci navodi nas na zaključak da prosječna duljina boravka varira ovisno o tipu iznajmljene sobe, a to ćemo sada testirati. 

Naša testne hipoteze biti će: \       
$$ \begin{aligned}
  H_0 & : \text{prosječna duljina boravka jednaka je za sve tipove iznajmljenih soba } \\
  H_1 & : \text{za barem jedan tip iznajmljene sobe prosječna duljina boravka različita je no u ostalih}
\end{aligned} $$

```{r ANOVA rooms}
#ANOVA
a = aov(filtered_data$TotalStays ~ filtered_data$AssignedRoomType)
summary(a)
```
Zaključak: \    
Na temelju malene p-vrijednosti odbacujemo nultu hipotezu u korist altervativne hipoteze: **postoje razlike u duljini trajanja boravka ovisno o tipu iznajmljene sobe.**

## Trajanje prosječnog boravka i kategorija gosta

Naše iduće istraživačko pitanje je slijedeće: \   
Možemo li trajanje boravka povezati s kategorijom gosta?

Procedura zaključivanja i odgovaranja na ovo istraživačko pitanje ista je prethodnom. \  
Pogledajmo koje sve kategorije gostiju postoje.  

```{r}
#all different values of "CustomerType" variable
customer_types = unique(data_total_stays$CustomerType)
customer_types
```
Iz priloženog možemo vidjeti da postoji 4 različitih kategorija gostiju, prema tome, uzimamo 4 podskupova podataka i uspoređujemo njihove aritmetičke sredine duljine trajanja boravka (varijabla "TotayStays").  

Za dati odgovor na istraživačko pitanje koristit ćemo se jednofaktorskim ANOVA modelom.

Provjeravamo jesu li zadovoljene predpostavke ANOVE (za provjeru predpostavke normalnosti koristimo se Lillieforsovom inačicom KS testa, a za provjeru predpostavke homogensoti varijanca koristimo se Bartlettovim testom).

```{r}
#normality check
require(nortest)

lillie.test(data_total_stays[data_total_stays$CustomerType == "Transient", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$CustomerType == "Contract", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$CustomerType == "Transient-Party", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$CustomerType == "Group", ]$TotalStays)
```
Iznimno malene p-vrijednosti nam govore kako podaci nisu normalno distribuirani.\ 
Usprkos tome, jednofaktorska ANOVA je robusna statistika s obzirom na predpostavku normalnosti.

```{r}
# variance homogenity check
data_total_stays$CustomerType <- factor(data_total_stays$CustomerType)

# Check the number of observations in each group
group_counts <- table(data_total_stays$CustomerType)
valid_groups <- names(group_counts[group_counts >= 2])

#If there is at least two oservations in the group, proceed
filtered_data <- subset(data_total_stays, CustomerType %in% valid_groups)

#Bartlettovim test
bartlett.test(filtered_data$TotalStays ~ filtered_data$CustomerType)
```
Zbog malene p-vrijednosti odbacujemo homogenost varijanci, što prikazujemo i grafički. 

```{r}
#box and whisker plot --> mean, rangs, median, variances....
library(ggplot2)

# Assuming filtered_data$CustomerType is a factor
filtered_data$CustomerType <- factor(filtered_data$CustomerType)

# Create a boxplot using ggplot2
ggplot(filtered_data, aes(x = CustomerType, y = TotalStays)) +
  geom_boxplot(fill = "skyblue", color = "black") +
  labs(title = "Total Stays by Customer Type",
       x = "Customer Type",
       y = "Total Stays") +
  theme_minimal()
```
Dani podaci o distibuciji koja nije normalna i nehomogenosti varijanci navodi nas na zaključak da prosječna duljina boravka varira ovisno o tipu gosta, a to ćemo sada i testirati jednoparametarskom ANOVOM. 

Naša testne hipoteze biti će: \       
$$ \begin{aligned}
  H_0 & : \text{prosječna duljina boravka jednaka je za sve tipove gostiju } \\
  H_1 & : \text{za barem jedan tip gosta prosječna duljina boravka različita je no u ostalih}
\end{aligned} $$

```{r ANOVA customers}
#ANOVA
a = aov(filtered_data$TotalStays ~ filtered_data$CustomerType)
summary(a)
```
Zaključak: \    
Na temelju malene p-vrijednosti odbacujemo nultu hipotezu u korist altervativne hipoteze: **postoje razlike u duljini trajanja boravka ovisno o tipu gosta.**

Diskusija: \    
Kao što smo i mogli naslutiti, duljina boravka gosta varira s obzirom na različite parametre. Najdulji prosječni boravak jest ljeti, a duljina boravka varira i zavisno od tipa iznajmljene sobe te kategorije gosta. 

\newpage

# Case study: CIJENE

\newpage

# Case study: PANSION, POLUPANSION

\newpage

# Case study: OTKAZIVANJE REZERVACIJA

\newpage

# Case study: SKUPINE GOSTIJU IZ RAZLIČITIH ZEMALJA

\newpage

# Case study: OBITELJI S DJECOM 

Zanimaju nas obrasci ponašanja obitelji s djecom poput: koji tip sobe obitelji s djecom najčešće iznajmljuju, imaju li takvi gosti više posebnih zahtjeva naspram ostalih gostiju...

Kako bismo u nastavku zadatka mogli odgovoriti na postavljena pitanja, najprije ćemo postojeći dataset filtrirati i prilagoditi. 

```{r family dataset}
library(dplyr)

families = data_total_stays %>%
  filter(Adults > 0, Children >= 0, Babies > 0 | Adults > 0, Children > 0, Babies >= 0)
```

## Postoji li razlika u popularnosti traženih tipova soba s obzirom na broj djece koje obitelj ima?

Uvodimo novu varijablu koja obuhvaća i djecu i bebe i nazivamo ju "TotalNonAdults".

```{r children variable}
library(dplyr)

families_children_num = families %>%
  mutate(TotalNonAdults = Children + Babies)
```

Možemo naslutiti da će postojati razlika u popularnosti traženih tipova soba kod obitelji koje, primjerice, ima jedno dijete naspram obitelji koje imaju troje ili više djece. 

Naše hipoteze glase: \       
$$ \begin{aligned}
  H_0 & : \text{u svim tipovima soba su prosječno podjednako velike obitelji} \\
  H_1 & : \text{u barem jednom tipu sobe prosječna veličina obitelji je drugačija no u ostalih}
\end{aligned} $$

Ova problematika može se testirati ANOVOM, no ANOVA ima predpostavke na nezavisnost podataka u urozku, normalnu distribuciju i  homogenost varijanci.  \    
Želimo izbjeći predpostavku da je uzorak iz populaicje normalne distribucije pa ćemo se u testiranju hipoteze poslužiti Kruskal-Wallisovim testom. 

```{r kruskal-wallis rooms}
#KRUSKAL-WALLIS
kruskal.test(families_children_num$TotalNonAdults ~ families_children_num$ReservedRoomType)
```
Iz rezultata provedenog testa možemo vidjeti malenu p-vrijednost što nalaže odbacivanje nulte hipoteze u korist alternativne hipoteze.\          

Zaključak: \            
U barem jednom tipu sobe prosječna veličina obitelji je drugačija no u ostalih, što možemo sročiti i tako da postoji razlika u popularnosti traženih tipova soba s obzirom na broj djece koje obitelj ima, kao što smo i predpostavili. 

## Postoji li razlika u količini posebnih zahtjeva s obzirom na broj djece koje obitelj ima?

Postupak dolaženja do zaključka isti je kao u prethodnom primjeru, kako bismo izbjegli predpostavku normalnosti normalne distribucije populacije poslužiti ćemo se Kruskal-Wallisovim testom.

Naše hipoteze glase: \ 
$$ \begin{aligned}
  H_0 & : \text{prosječni broj posebnih zahtjeva ne razlikuje se s obzirom na broj članova obitelji} \\
  H_1 & : \text{za barem jedan broj članova obitelji, prosječni broj posebnih zahtjeva je drugačiji}
\end{aligned} $$

```{r kruskal-wallis special requests}
#KRUSKAL-WALLIS
kruskal.test(families_children_num$TotalNonAdults ~ families_children_num$TotalOfSpecialRequests)
```
Iz rezultata provedenog testa možemo vidjeti malenu p-vrijednost što nalaže odbacivanje nulte hipoteze u korist alternativne hipoteze.

Zaključak: \                
U ovisno o veličini obitelji, mijenja se i prosječni broj posebnih zahtjeva što možemo sročiti i tako da postoji razlika u količini posebnih zahtjeva s obzirom na broj djece koje obitelj ima. 

\newpage

# Case study: USPOREDBA LJETNIH SEZONA

ADR ("Average daily rate index") je glavni identifikator hotelijesko-turističke djelatnosti kojim se mjeri prosječna zarada po svakoj iznajmljenoj sobi u određenoj perodu vremena. To je omjer ukupnog prihoda hotela i broja iznajmljenih soba. Vrlo je važan kako bi hoteli znali odrediti svoju poslovnu i financijsku strategiju za budućnost. Viši ADR bi značio da hotel generira više prihoda po sobi, što može biti znak dobrog poslovanja. 

## Je li ljetna sezona 2017. bila profitabilnija hotelima nego ljetna sezona 2016.?

Kako bismo dobili odgovor na ovo pitanje poslužit ćemo se prethodno opisanim parametrom, ADR-om, kao indikatorom uspješnosti poslovanja hotela.

``` {r subsets}
#creating utility datasets
#summer 2016 data
summer_2016 = rbind(data[data$ArrivalDateMonth == "June",], 
               data[data$ArrivalDateMonth == "July",], 
               data[data$ArrivalDateMonth == "August",])
summer_2016 = summer_2016[summer_2016$ArrivalDateYear == 2016, ]

  
#summer 2017 data
summer_2017 = rbind(data[data$ArrivalDateMonth == "June",], 
               data[data$ArrivalDateMonth == "July",], 
               data[data$ArrivalDateMonth == "August",])
summer_2017 = summer_2017[summer_2017$ArrivalDateYear == 2017, ]
```

```{r }
#plotting data
#histogram of difference
hist(summer_2016$ADR - summer_2017$ADR,
     main=paste('Histogram of ADR in 2016 - 2017'),
     xlab='Difference of overall score')
#qq-plot for overall ADR
qqnorm(summer_2016$ADR - summer_2017$ADR, 
       pch = 1, 
       frame = FALSE, 
       main=paste('QQ-plot for overall score of ADR'))
qqline(summer_2016$ADR - summer_2017$ADR, 
       col = "steelblue", lwd = 2)
```
Iz vizualizacije razlika možemo naslutiti normalnost podataka, dok iz qq-plota vidimo tek malo odstupanje lijevog repa i desnog repa, uz normalnost podataka. 

Naša hipoteze su sljedeće: \       
$$ \begin{aligned}
  H_0 & : \text{ljetne sezone su jednako profitabilne} \\
  H_1 & : \text{sezona 2017. profitabilnija je od ljetne sezone 2016.}
\end{aligned} $$

```{r two sample t}
t.test(summer_2016$ADR, 
       summer_2017$ADR, 
       alt = "less")
```
Rezultati t-testa nalažu nam odbacivanje nulte hipoteze u korist alternativne hipoteze. \           

Zaključak: \            
2017. je hotelima bila profitabilnija godina, što smo mogli zaključiti i iz prikazanih histograma.  

\newpage



