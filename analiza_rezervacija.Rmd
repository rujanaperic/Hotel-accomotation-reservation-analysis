---
title: "Analiza rezervacija hotelskog smještaja"
subtitle: "Grupa Prosječni"
author: "Mario Mrvčić, Rujana Perić, Dorjan Štrbac, Sven Winkler"
output: pdf_document
date: "2023-12-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## OPIS ZADATKA

U današnje vrijeme turistička djelatnost jako je popularna, a tržište puno konkurencije. Zanima nas kako hoteli mogu prilagoditi svoje usluge kako bi poboljšali zadovoljnost gostiju i povećali profitabilnost. 

Posjedujući skup podataka koji detaljno dokumentira rezervacije u dva različita hotela želimo istražiti, bolje razumjeti i ispitati veze između boravka u hotelu, godišnjeg doba, socio-ekonomskog statusa gosta, cijena, tipa rezervacija i sličnih parametara danih skupom podataka. 

## Učitavanje podataka o rezervacijama 

Skup podataka sastoji se od 119390 podataka o rezervacijama u dva hotela. Svaki podatak o rezervaciji sastoji se od 31 varijable koje pružaju uvid u trendove dolaska, demografske podatke gostiju, njihove financijske obrasce... 

U nastavku je prikazan: 

- podatak o broju zapisa rezervacija 
```{r h1 data, h2 data, combined}
h1_data = read.csv("Rezervacije/Rezervacije_/H1.csv")
h2_data = read.csv("Rezervacije/Rezervacije_/H2.csv")
data <- rbind(h1_data, h2_data)
dim(data)
``` 

- primjer nekoliko zapisa
``` {r}
head(data)
```
- svi parametri rezervacija 
``` {r}
names(data)
```
\newpage

# Case study: TRAJANJE BORAVKA GOSTA 

Slijedi detaljna analiza trajanja boravka gosta s obrizom na različite parametre. 

## Trajanje prosječnog boravka tjekom različitih godišnjih doba

Dogovorno su godišnja doba definirana na idući način: \    
ljeto - lipanj, srpanj, kolovoz \    
jesen - rujan, listopad, studeni \   
zima - prosinac, siječanj, veljača \   
proljeće -ožujak, travanj, svibanj

Definiramo čeriti pomoćna skupa podataka za svako godišnje doba grupirajući po paramteru "ArrivalDateMonth".

```{r data by season}
summer = rbind(data[data$ArrivalDateMonth == "June",], 
               data[data$ArrivalDateMonth == "July",], 
               data[data$ArrivalDateMonth == "August",])

autumn = rbind(data[data$ArrivalDateMonth == "September",], 
               data[data$ArrivalDateMonth == "October",], 
               data[data$ArrivalDateMonth == "November",])

winter = rbind(data[data$ArrivalDateMonth == "December",], 
               data[data$ArrivalDateMonth == "January",], 
               data[data$ArrivalDateMonth == "February",])

spring = rbind(data[data$ArrivalDateMonth == "March",], 
               data[data$ArrivalDateMonth == "April",], 
               data[data$ArrivalDateMonth == "May",])
```

Pomoćnim skupovima dodajemo i parametar "TotalStays" koji predstavlja sumu vrijednosti parametara "StaysInWeekendNights" i "StaysInWeekNights" kako bismo dobili uvid o trajanju boravka gosta neovisno o danima u tjednu. 

```{r data by season, total stays}
library(magrittr)
library(dplyr)

summer_total <- summer %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)

autumn_total <- autumn %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)

winter_total <- winter %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)

spring_total <- spring %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)
```
Računamo prosječnu duljinu trajanja boravka za svaki pomoćni skup podataka, rezultat prikazujemo stupičastim dijagramom.  

```{r means by seasons data}

seasons_means_vector = data.frame(
  Season = c("Winter", "Spring", "Summer", "Autumn"), 
  Means = c(mean(winter_total$TotalStays), 
            mean(spring_total$TotalStays), 
            mean(summer_total$TotalStays), 
            mean(autumn_total$TotalStays))
)

barplot(seasons_means_vector$Means, names.arg = seasons_means_vector$Season, col = "skyblue", xlab = "Seasons", ylab = "Average night stays")

#binding adjusted data
data_total_stays = rbind(winter_total, spring_total, summer_total, autumn_total)
```
Iz histograma možemo zaključiti da je prosječni boravak gostiju najduži ljeti, a najkraći zimi. 

## Trajanje prosječnog boravka i tip iznajmljene sobe

Naše istraživačko pitanje je slijedeće: \   
Možemo li trajanje boravka povezati s tipom iznajmljene sobe?

Pogledajmo najprije koje sve kategorije soba za iznajmljivanje postoje.

```{r}
#all different values of "ReservedRoomType" variable
room_types = unique(data_total_stays$AssignedRoomType)
room_types
```
Iz priloženog možemo vidjeti da postoji 12 različitih kategorija soba, prema tome, uzimamo 12 podskupova podataka i uspoređujemo njihove aritmetičke sredine duljine trajanja boravka (varijabla "TotayStays").  

Za dati odgovor na istraživačko pitanje koristit ćemo se jednofaktorskim ANOVA modelom.

Pretpostavke ANOVE su: \ 
- nezavisnost pojedinih podataka u uzorcima \  
- normalna razdioba podataka \ 
- homogenost varijanci među populacijama \ 

Kako nam veličine grupa nisu podjednake, radimo provjeru normalnosti Lillieforsovom inačicom Kolmogorov-Smirnovljenog testa. 
Razmatrat ćemo tip sobe kao varijablu koja određuje grupe i ukupnu duljinu boravka kao zavisnu varijablu. 

```{r test predpostavki - normalnost}
require(nortest)

lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "I               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "A               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "E               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "D               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "F               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "C               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "H               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "G               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "P               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "B               ", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$AssignedRoomType == "K               ", ]$TotalStays)
```
Iznimno malene p-vrijednosti nam govore kako podaci nisu normalno distribuirani.\ 
Usprkos tome, jednofaktorska ANOVA je robusna statistika s obzirom na pretpostavku normalnosti. Dobro tolerira odstupanja od normalne distribucije. 

Što se tiče homogenosti varijanci različitih populacija, potrebno je testirati:
$$ \begin{aligned}
  H_0 & : \sigma_1^2 = \sigma_2^2 = \ldots = \sigma_k^2 \\
  H_1 & : \text{barem dvije varijance nisu iste}.
\end{aligned} $$
Navedenu hipotezu možemo testirati Bartlettovim testom. 

```{r test pretpostavki - homogenost varijanci}

data_total_stays$AssignedRoomType <- factor(data_total_stays$AssignedRoomType)

# Check the number of observations in each group
group_counts <- table(data_total_stays$AssignedRoomType)
valid_groups <- names(group_counts[group_counts >= 2])

#If there is at least two oservations in the group, proceed
filtered_data <- subset(data_total_stays, AssignedRoomType %in% valid_groups)

#Bartlettovim test
bartlett.test(filtered_data$TotalStays ~ filtered_data$AssignedRoomType)
```
Varijance varijable "TotalStays" nisu podjednake, što je grafički prikazano u nastavku. 

```{r plotting}
#box and whisker plot --> mean, rangs, median, variances....
library(ggplot2)

# Assuming filtered_data$AssignedRoomType is a factor
filtered_data$AssignedRoomType <- factor(filtered_data$AssignedRoomType)

# Create a boxplot using ggplot2
ggplot(filtered_data, aes(x = AssignedRoomType, y = TotalStays)) +
  geom_boxplot(fill = "skyblue", color = "black") +
  labs(title = "Total Stays by Assigned Room Type",
       x = "Assigned Room Type",
       y = "Total Stays") +
  theme_minimal()
```


Dani podaci o distibuciji koja nije normalna i nehomogenosti varijanci navodi nas na zaključak da prosječna duljina boravka varira ovisno o tipu iznajmljene sobe, a to ćemo sada testirati. 

Naša testne hipoteze biti će: \       
$$ \begin{aligned}
  H_0 & : \text{prosječna duljina boravka jednaka je za sve tipove iznajmljenih soba } \\
  H_1 & : \text{za barem jedan tip iznajmljene sobe prosječna duljina boravka različita je no u ostalih}
\end{aligned} $$

```{r ANOVA rooms}
#ANOVA
a = aov(filtered_data$TotalStays ~ filtered_data$AssignedRoomType)
summary(a)
```
Zaključak: \    
Na temelju malene p-vrijednosti odbacujemo nultu hipotezu u korist altervativne hipoteze: **postoje razlike u duljini trajanja boravka ovisno o tipu iznajmljene sobe.**

## Trajanje prosječnog boravka i kategorija gosta

Naše iduće istraživačko pitanje je slijedeće: \   
Možemo li trajanje boravka povezati s kategorijom gosta?

Procedura zaključivanja i odgovaranja na ovo istraživačko pitanje ista je prethodnom. \  
Pogledajmo koje sve kategorije gostiju postoje.  

```{r}
#all different values of "CustomerType" variable
customer_types = unique(data_total_stays$CustomerType)
customer_types
```
Iz priloženog možemo vidjeti da postoji 4 različitih kategorija gostiju, prema tome, uzimamo 4 podskupova podataka i uspoređujemo njihove aritmetičke sredine duljine trajanja boravka (varijabla "TotayStays").  

Za dati odgovor na istraživačko pitanje koristit ćemo se jednofaktorskim ANOVA modelom.

Provjeravamo jesu li zadovoljene pretpostavke ANOVE (za provjeru pretpostavke normalnosti koristimo se Lillieforsovom inačicom KS testa, a za provjeru pretpostavke homogenosti varijanca koristimo se Bartlettovim testom).

```{r}
#normality check
require(nortest)

lillie.test(data_total_stays[data_total_stays$CustomerType == "Transient", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$CustomerType == "Contract", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$CustomerType == "Transient-Party", ]$TotalStays)
lillie.test(data_total_stays[data_total_stays$CustomerType == "Group", ]$TotalStays)
```
Iznimno malene p-vrijednosti nam govore kako podaci nisu normalno distribuirani.\ 
Usprkos tome, jednofaktorska ANOVA je robusna statistika s obzirom na pretpostavku normalnosti.

```{r}
# variance homogenity check
data_total_stays$CustomerType <- factor(data_total_stays$CustomerType)

# Check the number of observations in each group
group_counts <- table(data_total_stays$CustomerType)
valid_groups <- names(group_counts[group_counts >= 2])

#If there is at least two oservations in the group, proceed
filtered_data <- subset(data_total_stays, CustomerType %in% valid_groups)

#Bartlettovim test
bartlett.test(filtered_data$TotalStays ~ filtered_data$CustomerType)
```
Zbog malene p-vrijednosti odbacujemo homogenost varijanci, što prikazujemo i grafički. 

```{r}
#box and whisker plot --> mean, rangs, median, variances....
library(ggplot2)

# Assuming filtered_data$CustomerType is a factor
filtered_data$CustomerType <- factor(filtered_data$CustomerType)

# Create a boxplot using ggplot2
ggplot(filtered_data, aes(x = CustomerType, y = TotalStays)) +
  geom_boxplot(fill = "skyblue", color = "black") +
  labs(title = "Total Stays by Customer Type",
       x = "Customer Type",
       y = "Total Stays") +
  theme_minimal()
```
Dani podaci o distibuciji koja nije normalna i nehomogenosti varijanci navodi nas na zaključak da prosječna duljina boravka varira ovisno o tipu gosta, a to ćemo sada i testirati jednoparametarskom ANOVOM. 

Naše testne hipoteze biti će: \       
$$ \begin{aligned}
  H_0 & : \text{prosječna duljina boravka jednaka je za sve tipove gostiju } \\
  H_1 & : \text{za barem jedan tip gosta prosječna duljina boravka različita je no u ostalih}
\end{aligned} $$

```{r ANOVA customers}
#ANOVA
a = aov(filtered_data$TotalStays ~ filtered_data$CustomerType)
summary(a)
```
Zaključak: \    
Na temelju malene p-vrijednosti odbacujemo nultu hipotezu u korist altervativne hipoteze: **postoje razlike u duljini trajanja boravka ovisno o tipu gosta.**

Diskusija: \    
Kao što smo i mogli naslutiti, duljina boravka gosta varira s obzirom na različite parametre. Najdulji prosječni boravak jest ljeti, a duljina boravka varira i zavisno od tipa iznajmljene sobe te kategorije gosta. 

\newpage

# Case study: CIJENE

\newpage

# Case study: PANSION, POLUPANSION

"Je li vrsta uplaćenog obroka (pansion, polupansion) povezana s kategorijama kupaca?"

### Opis traženih atributa

Vrstu uplaćenog obroka vidimo pod "Meal"

```{r}
meals <- data$Meal
levels(factor(data$Meal))
table(meals)
```
Značenja kratica:

BB -> Samo doručak,

FB -> Polupansion,

HB -> Puni pansion,

SC -> Bez hotelskih obroka ("Self-Catering"),

Undefined -> Nije definirano,

Vrstu kategorija kupaca vidimo pod "CustomerType"

```{r}
types <- data$CustomerType
levels(factor(data$CustomerType))
table(types)
```

Contract -> primjeri: poslovna putovanja, rezervacije za konferencije ili događaje

Group -> primjeri: turističke grupe, konferencijski timovi, sportski timovi

Transient -> primjeri: individualni putnici, turisti koji putuju sami

Transient-Party -> primjeri: Grupe prijatelja ili obitelji koje putuju zajedno, ali nisu rezervirale kao formalna grupa

## Je li vrsta uplaćenog obroka (pansion, polupansion) povezana s kategorijama kupaca?

Kopirajmo najprije podatke u novi data.frame kako ne bi promijenili prave vrijednosti

```{r}
data_copy <- data
```

Kontingencijsku tablicu jedne kategorijske varijable moguće je dobiti pozivanjem funkcije `table()`

```{r}
tbl = table(data_copy$Meal)
print(tbl)
```

Pogledajmo kontingencijsku tablicu varijabli obroka i kategorija kupaca

```{r}
tbl = table(data_copy$Meal, data_copy$CustomerType)
tbl
```

Kontingencijskoj tablici možemo dodati i sume redaka i stupaca na sljedeći način.

```{r}
added_margins_tbl = addmargins(tbl)
print(added_margins_tbl)
```

Test nezavisnosti $\chi^2$ test u programskom paketu R implementiran je u funkciji `chisq.test()` koja kao ulaz prima kontingencijsku tablicu podataka koje testiramo na nezavisnost. Ispitajmo nezavisnost obroka i tipa kupca.

Pretpostavka testa je da očekivana frekvencija pojedinog razreda mora biti veća ili jednaka 5 (`chisq.test()` pretpostavlja da je ovaj uvjet zadovoljen stoga je prije provođenja testa potrebno to provjeriti).

```{r}
for (col_names in colnames(added_margins_tbl)){
  for (row_names in rownames(added_margins_tbl)){
    if (!(row_names == 'Sum' | col_names == 'Sum') ){
      cat('Očekivane frekvencije za razred ',col_names,'-',row_names,': ',
          (added_margins_tbl[row_names,'Sum'] * added_margins_tbl['Sum',col_names])
          / added_margins_tbl['Sum','Sum'],'\n')
    }
  }
}
```
Vidimo mogući problem:
"Očekivane frekvencije za razred  Group - FB        :  3.856655"

$\chi^2$ test zahtjeva frekvencije veće od 5, pa ćemo trebati izostaviti ovaj razred na neki način.
FB sadrži malen broj podataka, tako da bi mogao biti izostavljen potpuno.

Također smatramo da bi bilo dobro izostaviti varijable "Undefined" jer predstavljaju nepoznanicu koju je teško interpretirati.

Odluka je maknuti Undefined i FB iz kategorije Meals.

```{r}
cat("Kontingencijska tablica prije: \n")
table(data_copy$Meal)

cat("\n-----------------------------------\n")
data_modified <- data_copy[trimws(data_copy$Meal) != "Undefined" & trimws(data_copy$Meal) != "FB", ]

cat("Kontingencijska tablica poslije: \n")
table(data_modified$Meal)
```

Ponovimo prethodni postupak na data_modified

```{r}
tbl <- table(data_modified$Meal, data_modified$CustomerType)
tbl

added_margins_tbl = addmargins(tbl)
added_margins_tbl
```
```{r}
for (col_names in colnames(added_margins_tbl)){
  for (row_names in rownames(added_margins_tbl)){
    if (!(row_names == 'Sum' | col_names == 'Sum') ){
      cat('Očekivane frekvencije za razred ',col_names,'-',row_names,': ',
          (added_margins_tbl[row_names,'Sum'] * added_margins_tbl['Sum',col_names])
          / added_margins_tbl['Sum','Sum'],'\n')
    }
  }
}
```
Sada vidimo da su sve frekvencije zadovoljavajuće, te nemamo nepoznanica.
Možemo nastaviti sa $\chi^2$ testom.

```{r}
chisq.test(tbl,correct=F)
```
Na temelju vrlo male P-vrijednosti(p-value < 2.2e-16), odbacujemo H0 u korist H1 koja kaže da su vrsta obroka i kategorija gosta zavisni podaci.

\newpage

# Case study: OTKAZIVANJE REZERVACIJA

## Prikaz omjera otkazanih rezervacija

```{R}
library(ggplot2)

total_count <- nrow(data)
canceled_count <- sum(data$IsCanceled == 1)
non_canceled_count <- total_count-canceled_count

ggplot(data, aes(x = factor(IsCanceled))) +
  geom_bar(width = 0.5) +
  labs(x = "Reservation Status", y = "Count", title = "Number of Canceled and Non-Canceled Reservations") +
  scale_x_discrete(labels = c("Non-Canceled", "Canceled")) +
  scale_y_continuous(breaks = seq(0, max(total_count), by = 10000))

```

Kroz ovaj prikaz možemo vidjeti ukupan broj otkazanih i ne-otkazanih rezervacija za priložne podatke.\        

Otkazanih rezervacija je bilo: 44224 od ukupno 119390. Ovo znači da je 37.04% ukupnih rezervacija otkazano. Zanima nas ima li korelacije nekih parametara iz naših podataka sa otkazivanjem rezervacija. \        
Koristimo regresijske metode s obzirom da nam regresijska analiza omogućuje zaključivanje i predviđanje jedne varijable na temelju jedne ili više varijabli, te mjerenje utjecaja jedne ili više varijabli s obzirom na ostale. \        

U našem slučaju ovisna variajbla će biti IsCanceled varijabla koja nam govori jesu li rezervacije otazane. Pregledom liste svih varijabli odabrali smo varijable za koje smatramo da će imati najveći učinak na otkazivanje te će nam one činiti neovisne varijable. Odabrane varijable su:

\begin{itemize}
    \item LeadTime (Vrijeme od trenutka rezervacije do rezervacije)
    \item Previous cancelations
    \item Previous booking not cancled
\end{itemize}

### Lead Time            

Prvo pitanje koje postavljamo je ima li broj LeadTime utjecaja na otkazivanje rezervacije?

```{R}
library(ggplot2)

ggplot(data, aes(x = LeadTime, y = IsCanceled )) +
  geom_jitter(height = .05, alpha = .1) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE)

```
Iz prikaza modela se da naslutiti da ima. Možemo primjetiti da veće vrijednosti varijable LeadTime imaju više otkazivanja. Koristimo funkciju za logističku regresiju u programu R kako bi detaljnije analizirali: 

```{R}
logisticLT <- glm(formula = IsCanceled ~ LeadTime, family = "binomial", data = data)
summary(logisticLT)
```

Objašnjenje dobivenog:

Estimate \            
Ovo predstavlja veličinu učinka svakog prediktora.

Standardna pogreška \           
Mjerena standardna devijacija procijenjenog koeficijenta koja odražava koliko precizno model procjenjuje vrijednost koeficijenta.

z-vrijednost  \           
Izračunat kao koeficijent podijeljen sa svojom standardnom pogreškom. Koristi se za testiranje nulte hipoteze.

p-vrijednost \        
P-vrijednost označava vjerojatnost opažanja podataka ako je nulta hipoteza istinita. Niža p-vrijednost sugerira da je nulta hipoteza manje vjerojatna.

Ovime vidimo da model predviđa da će logaritamski izgledi osnovnog ishoda biti -1.166e+00 kada su svi prediktori 0.\         
P-vrijednost od <2e-16 ukazuje da LeadTime utječe na otkazivanje rezervacija na statističkoj razini od 0.05 (5%) i 0.01 (1%)

Predikcije možemo dobiti od prediktora uvrštavanjme u formulu:

\[ y = \frac{1}{1 + e^{-(\alpha_1 + \alpha_2 x)}} \] 

gdje je alpha_1 predikator ovisne varijable a alpha_2 predikator neovisne varijable. Ovo je u našem slučaju:

\[ y = \frac{1}{1 + e^{-(1.116 + 0.005855 x)}} \] 

gdje je x broj dana prošao od rezervacije.

Ovo također možemo dobiti i kroz program R na sljedeći način:

```{r}
# Napravimo novi podatkovni okvir s varijablama predviđanja za koje želimo predvidjeti
new_data <- data.frame(LeadTime = c(0, 100, 200, 400))
# Koristimo funkciju za predviđanje
predicted_probabilities <- predict(logisticLT, newdata = new_data, type = "response")
# Prikazujemo rezultate
print(predicted_probabilities)

```
Samim time možemo zaključiti da LeadTime utječe na otkazivanje rezervacija. Odnosno rezervacije **rezervirane za daleko u budućnost imaju veću šansu za otkazivanje.**

### Previous Cancelations

Nastavljamo sa promatranjem varijable Previous Cancelations. Ponavljamo postupke iz prošle analize.

```{R}
library(ggplot2)

ggplot(data, aes(x = PreviousCancellations, y = IsCanceled )) +
  geom_jitter(height = .05, alpha = .1) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE)

```

Na modelu se da primjetiti da prijašnja otkazivanja rezervacija imaju utjecaj na otkazivanje rezervacija.

```{R}
logisticPC <- glm(formula = IsCanceled ~ PreviousCancellations, family = "binomial", data = data)
summary(logisticPC)
```

Ovo nam potvrđuju i dobiveni podatci. Model predviđa da će logaritamski izgledi osnovnog ishoda biti -0.642251 kada su svi prediktori 0. \        
P-vrijednost od <2e-16 ukazuje da PreviousCancellations utječe na otkazivanje rezervacija na statističkoj razini od 0.05 (5%) i 0.01 (1%). 

Odnosno **sa brojem prijašnjih otkazanih rezervacija raste šansa za otkazivanjem budućih rezervacija.**


### Previous bookings not canceled

Nastavljamo sa promatranjem varijable Previous bookings not canceled.Ponavljamo postupke iz prošlih analiza.

```{R}
library(ggplot2)

ggplot(data, aes(x = PreviousBookingsNotCanceled, y = IsCanceled )) +
  geom_jitter(height = .05, alpha = .1) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), se = TRUE)

```

Kao i kod prijašnjih modela i na ovom modelu možemo primjetiti korelaciju podataka.

```{R}
logisticPC <- glm(formula = IsCanceled ~ PreviousBookingsNotCanceled, family = "binomial", data = data)
summary(logisticPC)
```

Ovo nam opet potvrđuju dobiveni podatci. Model predviđa da će logaritamski izgledi osnovnog ishoda biti -0.505722 kada su svi prediktori 0. \       
P-vrijednost od <2e-16 ukazuje da PreviousBookingsNotCanceled utječu na otkazivanje rezervacija na statističkoj razini od 0.05 (5%) i 0.01 (1%).
 
Što daje naslutiti da je šansa za otkazivanje manja u ljudi koji su imali prijašnje ne otkazane rezervacije.

\textbf{Zaključak:}

Model logističke regresije snažan je alat koji nam daje uvid u ovisnost komponenti te mogućnost predikcije ukoliko postoji neka korelacija. \       
Ovo nam u konkretnom slučaju koristi na način da putem predikcija možemo naslutiti na moguća otkazivanja u slučaju riskantnih rezervacija te poduzimanja koraka koji bi mogli smanjiti taj broj. \        
Npr. u slučaju rezervacija s velikim Lead time varijablama možemo "overbookirat" te termine ili ih ne "overbokirat" u slučaju velikih "previous bookings not canceled" varijabli. Također bi se mogle uvesti naknade za otkazivanje za ljude sa velikim brojem prijašnjih otkazivanja s obzirom da je rizik za otkazivanje kod njih veći.

\newpage

# Case study: SKUPINE GOSTIJU IZ RAZLIČITIH ZEMALJA

## ADR (Avrage daily rate)

Zanima nas možemo li povezati dnevnu potrošnju sa porjeklom zemlje gosta.

Prvo pregledavamo iz kojih sve gosti zemalja uopće dolaze.

```{r}
allCountries = unique(data$Country)
allCountries
```

Primjećujemo da su gosti iz 178 zemlaja te uspoređujemo njihove aritmetičke sredine dnevne potrošnje (varijabla "ADR").  \        
Kako bi vidjeli možemo li povezati dnevnu potrošnju sa porjeklom zemlje, koristit ćemo se jednofaktorskim ANOVA modelom.

Predpostavke ANOVE su u ovom projektu već navedene u analizi koja se bavila sa trajanjima boravka gostiju. \        

Kako nam veličine grupa nisu podjednake, radimo provjeru normalnosti Lillieforsovom inačicom Kolmogorov-Smirnovljenog testa. Ovaj test zahtjeva minimalnu veličinu uzorka od 4, stoga transformiramo podatke da dobijemo samo države koje iz kojih su došle 4 ili više osoba. 

```{r}
data$Country <- factor(data$Country)
groupCount <- table(data$Country)
validCountries <- names(groupCount[groupCount > 4])
validCountries
```

Razmatrat ćemo zemlju kao varijablu koja određuje grupe i ukupnu duljinu boravka kao zavisnu varijablu. 

```{r}
library(nortest)

# Print the results
for (country in validCountries) {
  cat("Lilliefors test for", country, "\n")
  print(lillie.test(data[data$Country == country, ]$ADR))
}

```
Na temelju p-vrijednosti u našim rezultatima primjećujemo:\       

Mnoge zemlje imaju p-vrijednosti manje od 0,05, što ukazuje da podaci o ADR-u za te zemlje ne slijede normalnu distribuciju. Na primjer, zemlje poput ARE, ARG, BEL, BRA, CHN, COL, DEU, ESP, FRA, GBR, IND, ITA, JPN, MEX, NLD, NOR, PRT i SAD sve imaju p-vrijednosti manje od 0,05.\       

Neke zemlje imaju p-vrijednosti veće od 0,05, što sugerira da podaci o ADR-u za te zemlje mogu razumno odgovarati normalnoj distribuciji. Na primjer, ALB, AND, BGR, BHR, CIV, CMR, CPV, CRI, CYP i drugi imaju p-vrijednosti veće od 0,05. \       

Važno je napomenuti da niska p-vrijednost ne znači nužno da podaci nisu korisni ili nevažeći; to jednostavno sugerira da podaci možda ne slijede normalnu distribuciju. \       
Usprkos tome, jednofaktorska ANOVA je robusna statistika s obzirom na predpostavku normalnosti. Dobro tolerira odstupanja od normalne distribucije. 

Što se tiče homogenosti varijanci različitih populacija, potrebno je testirati:
$$ \begin{aligned}
  H_0 & : \sigma_1^2 = \sigma_2^2 = \ldots = \sigma_k^2 \\
  H_1 & : \text{barem dvije varijance nisu iste}.
\end{aligned} $$
Navedenu hipotezu možemo testirati Bartlettovim testom. 

```{r}

filteredDataCountries <- subset(data, Country %in% validCountries)

#Bartlettovim test
bartlett.test(filteredDataCountries$ADR ~ filteredDataCountries$Country)
```

Na temelju rezultata Bartlettovog testa, čini se da varijance varijable "ADR" nisu jednake među različitim zemljama. Ovo sugerira da postoje značajne razlike u varijabilnosti "ADR" vrijednosti u zemljama koje smo testirali. Ovo je grafički prikazano u nastavku. 

Dani podaci o distibuciji koja nije normalna i nehomogenosti varijanci navodi nas na zaključak da ADR varira ovisno o zemlji porjekla osobe, a to ćemo sada testirati. 

Naša testne hipoteze biti će: \       
$$ \begin{aligned}
  H_0 & : \text{ADR je jednak za osobe neovisno o porjeklu } \\
  H_1 & : \text{za barem jednu osobu sa različitim porjeklom prosječni ADR je različita od ostalih}
\end{aligned} $$

```{r}
#ANOVA
a = aov(filteredDataCountries$ADR ~ filteredDataCountries$Country)
summary(a)
```
Zaključak: \    
Na temelju malene p-vrijednosti odbacujemo nultu hipotezu u korist altervativne hipoteze: **postoje razlike u ADR ovisno o porjeklu osobe.**

\newpage

# Case study: OBITELJI S DJECOM 

Zanimaju nas obrasci ponašanja obitelji s djecom poput: koji tip sobe obitelji s djecom najčešće iznajmljuju, imaju li takvi gosti više posebnih zahtjeva naspram ostalih gostiju...

Kako bismo u nastavku zadatka mogli odgovoriti na postavljena pitanja, najprije ćemo postojeći dataset filtrirati i prilagoditi. 

```{r family dataset}
library(dplyr)

families = data_total_stays %>%
  filter(Adults > 0, Children >= 0, Babies > 0 | Adults > 0, Children > 0, Babies >= 0)
```

## Postoji li razlika u popularnosti traženih tipova soba s obzirom na broj djece koje obitelj ima?

Uvodimo novu varijablu koja obuhvaća i djecu i bebe i nazivamo ju "TotalNonAdults".

```{r children variable}
library(dplyr)

families_children_num = families %>%
  mutate(TotalNonAdults = Children + Babies)
```

Možemo naslutiti da će postojati razlika u popularnosti traženih tipova soba kod obitelji koje, primjerice, ima jedno dijete naspram obitelji koje imaju troje ili više djece. 

Naše hipoteze glase: \       
$$ \begin{aligned}
  H_0 & : \text{u svim tipovima soba su prosječno podjednako velike obitelji} \\
  H_1 & : \text{u barem jednom tipu sobe prosječna veličina obitelji je drugačija no u ostalih}
\end{aligned} $$

Ova problematika može se testirati ANOVOM, no ANOVA ima predpostavke na nezavisnost podataka u urozku, normalnu distribuciju i  homogenost varijanci.  \    
Želimo izbjeći predpostavku da je uzorak iz populaicje normalne distribucije pa ćemo se u testiranju hipoteze poslužiti Kruskal-Wallisovim testom. 

```{r kruskal-wallis rooms}
#KRUSKAL-WALLIS
kruskal.test(families_children_num$TotalNonAdults ~ families_children_num$ReservedRoomType)
```
Iz rezultata provedenog testa možemo vidjeti malenu p-vrijednost što nalaže odbacivanje nulte hipoteze u korist alternativne hipoteze.\          

Zaključak: \            
U barem jednom tipu sobe prosječna veličina obitelji je drugačija no u ostalih, što možemo sročiti i tako da postoji razlika u popularnosti traženih tipova soba s obzirom na broj djece koje obitelj ima, kao što smo i predpostavili. 

## Postoji li razlika u količini posebnih zahtjeva s obzirom na broj djece koje obitelj ima?

Postupak dolaženja do zaključka isti je kao u prethodnom primjeru, kako bismo izbjegli predpostavku normalnosti normalne distribucije populacije poslužiti ćemo se Kruskal-Wallisovim testom.

Naše hipoteze glase: \ 
$$ \begin{aligned}
  H_0 & : \text{prosječni broj posebnih zahtjeva ne razlikuje se s obzirom na broj članova obitelji} \\
  H_1 & : \text{za barem jedan broj članova obitelji, prosječni broj posebnih zahtjeva je drugačiji}
\end{aligned} $$

```{r kruskal-wallis special requests}
#KRUSKAL-WALLIS
kruskal.test(families_children_num$TotalNonAdults ~ families_children_num$TotalOfSpecialRequests)
```
Iz rezultata provedenog testa možemo vidjeti malenu p-vrijednost što nalaže odbacivanje nulte hipoteze u korist alternativne hipoteze.

Zaključak: \                
U ovisno o veličini obitelji, mijenja se i prosječni broj posebnih zahtjeva što možemo sročiti i tako da postoji razlika u količini posebnih zahtjeva s obzirom na broj djece koje obitelj ima. 

\newpage

# Case study: USPOREDBA LJETNIH SEZONA

ADR ("Average daily rate index") je glavni identifikator hotelijesko-turističke djelatnosti kojim se mjeri prosječna zarada po svakoj iznajmljenoj sobi u određenoj perodu vremena. To je omjer ukupnog prihoda hotela i broja iznajmljenih soba. Vrlo je važan kako bi hoteli znali odrediti svoju poslovnu i financijsku strategiju za budućnost. Viši ADR bi značio da hotel generira više prihoda po sobi, što može biti znak dobrog poslovanja. 

## Je li ljetna sezona 2017. bila profitabilnija hotelima nego ljetna sezona 2016.?

Kako bismo dobili odgovor na ovo pitanje poslužit ćemo se prethodno opisanim parametrom, ADR-om, kao indikatorom uspješnosti poslovanja hotela.

``` {r subsets}
#creating utility datasets
#summer 2016 data
summer_2016 = rbind(data[data$ArrivalDateMonth == "June",], 
               data[data$ArrivalDateMonth == "July",], 
               data[data$ArrivalDateMonth == "August",])
summer_2016 = summer_2016[summer_2016$ArrivalDateYear == 2016, ]

  
#summer 2017 data
summer_2017 = rbind(data[data$ArrivalDateMonth == "June",], 
               data[data$ArrivalDateMonth == "July",], 
               data[data$ArrivalDateMonth == "August",])
summer_2017 = summer_2017[summer_2017$ArrivalDateYear == 2017, ]
```

```{r }
#plotting data
#histogram of difference
hist(summer_2016$ADR - summer_2017$ADR,
     main=paste('Histogram of ADR in 2016 - 2017'),
     xlab='Difference of overall score')
#qq-plot for overall ADR
qqnorm(summer_2016$ADR - summer_2017$ADR, 
       pch = 1, 
       frame = FALSE, 
       main=paste('QQ-plot for overall score of ADR'))
qqline(summer_2016$ADR - summer_2017$ADR, 
       col = "steelblue", lwd = 2)
```
Iz vizualizacije razlika možemo naslutiti normalnost podataka, dok iz qq-plota vidimo tek malo odstupanje lijevog repa i desnog repa, uz normalnost podataka. 

Naša hipoteze su sljedeće: \       
$$ \begin{aligned}
  H_0 & : \text{ljetne sezone su jednako profitabilne} \\
  H_1 & : \text{sezona 2017. profitabilnija je od ljetne sezone 2016.}
\end{aligned} $$

```{r two sample t}
t.test(summer_2016$ADR, 
       summer_2017$ADR, 
       alt = "less")
```
Rezultati t-testa nalažu nam odbacivanje nulte hipoteze u korist alternativne hipoteze. \           

Zaključak: \            
2017. je hotelima bila profitabilnija godina, što smo mogli zaključiti i iz prikazanih histograma.  

## Kako da hoteli u budućnosti budu još profitabilniji?

Da bismo pomogli hotelima u stvaranju još bolje poslovne strategije, ispitati ćemo korelacije nekoliko parametara iz naših podataka sa ADR-om. Za utvrđivanje korelacije koristit ćemo se regresijskim metodama, gdje je kao zavisna varijabla postavljen ADR, a kao nezavisne varijable:
\begin{itemize}
    \item "DaysInWaitingList"
\end{itemize}

Konkretno, u oba slučaja, korelaciju ćemo testirati jednostavnom linearnom regresijom. 

### Days in waiting list

Zanima nas je li broj dana na listi čekanja koreliran sa ADR-om, tj. kada bi gost bio kraće na listi čekanja, bi li hotel bio "profitabilniji"?

```{r}

library(ggplot2)

ggplot(data_total_stays, aes(x = DaysInWaitingList, y = ADR )) +
  geom_jitter(height = 0.5, alpha = .1) +
  geom_smooth(method = "lm", se = TRUE) + 
  ylim(0, 500)

```
Iz prikaza možemo naslutiti da određena korelacija postoji, no idemo to testirati linearnom regresijom: 

```{R}
linear_model <- lm(formula = ADR ~ DaysInWaitingList, data = data)
summary(linear_model)
```
Zaključak: \        
Provedeni test nam govori da će, za povećanje varijable "DaysInWaitingList" za 1, ADR biti promjenjen za -0.117061 (Estimate), sa standardom greškom od 0.008306 (Std. Error). Vjerojatnost da će se dogoditi rezultat jednak ili ekstremniji t-vrijednosti je vrlo blizu nuli, što znači da je parametar "DaysInWaitingList" signifikantan za predviđanje parametra ADR.

Zaključujemo da su ta dva parametra značajno korelirana, te da će **kraće vrijeme na listi čekanja pridonositi većoj profitabilnosti hotela**. 

\newpage



