---
title: "Analiza rezervacija hotelskog smještaja"
subtitle: "Grupa Prosječni"
author: "Mario Mrvčić, Rujana Perić, Dorjan Štrbac, Sven Winkler"
output: pdf_document
date: "2023-12-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## OPIS ZADATKA

U današnje vrijeme turistička djelatnost jako je popularna, a tržište puno konkurencije. Zanima nas kako hoteli mogu prilagoditi svoje usluge kako bi poboljšali zadovoljnost gostiju i povećali profitabilnost. 

Posjedujući skup podataka koji detaljno dokumentira rezervacije u dva različita hotela želimo istražiti, bolje razumjeti i ispitati veze između boravka u hotelu, godišnjeg doba, socio-ekonomskog statusa gosta, cijena, tipa rezervacija i sličnih parametara danih skupom podataka. 

## Učitavanje podataka o rezervacijama 

Skup podataka sastoji se od 119390 podataka o rezervacijama u dva hotela. Svaki podatak o rezervaciji sastoji se od 31 varijable koje pružaju uvid u trendove dolaska, demografske podatke gostiju, njihove financijske obrasce... 

U nastavku je prikazan: 

- podatak o broju zapisa rezervacija 
```{r h1 data, h2 data, combined}
h1_data = read.csv("Rezervacije/Rezervacije_/H1.csv")
h2_data = read.csv("Rezervacije/Rezervacije_/H2.csv")
data <- rbind(h1_data, h2_data)
dim(data)
``` 

- primjer nekoliko zapisa
``` {r}
head(data)
```
- svi parametri rezervacija 
``` {r}
names(data)
```
\newpage

# Case study: TRAJANJE BORAVKA GOSTA 

Slijedi detaljna analiza trajanja boravka gosta s obrizom na različite parametre. 

### Trajanje prosječnog boravka tjekom različitih godišnjih doba

Dogovorno su godišnja doba definirana na idući način: \    
ljeto - lipanj, srpanj, kolovoz \    
jesen - rujan, listopad, studeni \   
zima - prosinac, siječanj, veljača \   
proljeće -ožujak, travanj, svibanj

Definiramo čeriti pomoćna skupa podataka za svako godišnje doba grupirajući po paramteru "ArrivalDateMonth".

```{r data by season}
summer = rbind(data[data$ArrivalDateMonth == "June",], 
               data[data$ArrivalDateMonth == "July",], 
               data[data$ArrivalDateMonth == "August",])

autumn = rbind(data[data$ArrivalDateMonth == "September",], 
               data[data$ArrivalDateMonth == "October",], 
               data[data$ArrivalDateMonth == "November",])

winter = rbind(data[data$ArrivalDateMonth == "December",], 
               data[data$ArrivalDateMonth == "January",], 
               data[data$ArrivalDateMonth == "February",])

spring = rbind(data[data$ArrivalDateMonth == "March",], 
               data[data$ArrivalDateMonth == "April",], 
               data[data$ArrivalDateMonth == "May",])
```

Pomoćnim skupovima dodajemo i parametar "TotalStays" koji predstavlja sumu vrijednosti parametara "StaysInWeekendNights" i "StaysInWeekNights" kako bismo dobili uvid o trajanju boravka gosta neovisno o danima u tjednu. 

```{r data by season, total stays}
library(magrittr)
library(dplyr)

summer_total <- summer %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)
dim(summer_total)

autumn_total <- autumn %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)
dim(autumn_total)

winter_total <- winter %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)
dim(winter_total)

spring_total <- spring %>%
  mutate(TotalStays = StaysInWeekendNights + StaysInWeekNights)
dim(spring_total)
```
Iz novih dimenzija možemo vijeti da je dodan novi parametar svakom zapisu. 

Računamo prosječnu duljinu trajanja boravka za svaki pomoćni skup podataka, rezultat prikazujemo stupičastim dijagramom.  

```{r means by seasons data}

seasons_means_vector = data.frame(
  Season = c("Winter", "Spring", "Summer", "Autumn"), 
  Means = c(mean(winter_total$TotalStays), 
            mean(spring_total$TotalStays), 
            mean(summer_total$TotalStays), 
            mean(autumn_total$TotalStays))
)

barplot(seasons_means_vector$Means, names.arg = seasons_means_vector$Season, col = "skyblue", xlab = "Seasons", ylab = "Average night stays")

```
Iz histograma možemo zaključiti da je prosječni boravak gostiju najduži ljeti, a najkraći zimi. 

### Trajanje prosječnog boravka i tip iznajmljene sobe

Naše istraživačko pitanje je slijedeće: \   
Možemo li trajanje boravka povezati s tipom iznajmljene sobe?

Pogledajmo najprije koje sve kategorije soba za iznajmljivanje postoje.

```{r}
#binding adjusted data
data_total_stays = rbind(winter_total, spring_total, summer_total, autumn_total)
#all different values of "ReservedRoomType" variable

```
...objašnjenja što je koja soba...

```{r}
#calculating average "TotalStays" for every room type


#plotting data...

```

Iz priloženog možemo vidjeti da je prosječna duljina boravka najduža ...., a najkraća ....

```{r}
#box and whisker plot --> mean, rangs, median, variances....

```
... komentar na box and whisker plot...

Imajući detaljan uvid u dane statistike, nas zanima postoji li povezanost između duljine boravka i tipa iznajmljene sobe na razini značajnosti od 5%. 

Naša testne hipoteze biti će: \       
H_0: Prosječna duljina boravka jednaka je za sve tipove soba. \    
H_1: Za barem jedan tip sobe prosječna duljina boravka različita je od ostalih. \    

Test koji koristimo za ispirivanje ove hipoteze je ANOVA.

```{r ANOVA soba}
#ANOVA

```
Zaključak: \    
.......

Diskusija: \    
.......

### Trajanje prosječnog boravka i kategorija gosta

Naše iduće istraživačko pitanje je slijedeće: \   
Možemo li trajanje boravka povezati s kategorijom gosta?

Analizirajmo postojeće podatke iz databaze. Koje sve kategorije gostiju postoje.

```{r}
#all different values of "CustomerType" variable

```
...objašnjenja što je koja kategorija gosta...

```{r}
#calculating average "TotalStays" for every customer type


#plotting data...

```

Iz priloženog možemo vidjeti da je prosječna duljina boravka najduža ...., a najkraća ....

```{r}
#box and whisker plot --> mean, rangs, median, variances....

```
... komentar na box and whisker plot...

Zanima postoji li povezanost između duljine boravka i kategorije gosta na razini značajnosti od 5%. 

Naša testne hipoteze biti će: \       
H_0: Prosječna duljina boravka jednaka je za sve tipove gostiju. \    
H_1: Za barem jednu kategoriju gosta prosječna duljina boravka različita je od ostalih. \    

Test koji koristimo za ispirivanje ove hipoteze je ANOVA.

```{r ANOVA gost}
#ANOVA

```
Zaključak: \    
.......

Diskusija: \    
.......

............. ZAKLJUČNA DISKUSIJA ZA CIJELI CASE STUDY ...............
\newpage

# Case study: CIJENE

\newpage

# Case study: PANSION, POLUPANSION

"Je li vrsta uplaćenog obroka (pansion, polupansion) povezana s kategorijama kupaca?"

### Opis traženih atributa

Vrstu uplaćenog obroka vidimo pod "Meal"

```{r}
meals <- data$Meal
levels(factor(data$Meal))
table(meals)
```
Značenja kratica:

BB -> Samo doručak
FB -> Polupansion
HB -> Puni pansion 
SC -> Bez hotelskih obroka ("Self-Catering")
Undefined -> Nije definirano

Vrstu kategorija kupaca vidimo pod "CustomerType"

```{r}
types <- data$CustomerType
levels(factor(data$CustomerType))
table(types)
```

Contract -> primjeri: poslovna putovanja, rezervacije za konferencije ili događaje

Group -> primjeri: turističke grupe, konferencijski timovi, sportski timovi

Transient -> primjeri: individualni putnici, turisti koji putuju sami

Transient-Party -> primjeri: Grupe prijatelja ili obitelji koje putuju zajedno, ali nisu rezervirale kao formalna grupa

## Je li vrsta uplaćenog obroka (pansion, polupansion) povezana s kategorijama kupaca?

Kopirajmo najprije podatke u novi data.frame kako ne bi promijenili prave vrijednosti

```{r}
data_copy <- data
```

Kontingencijsku tablicu jedne kategorijske varijable moguće je dobiti pozivanjem funkcije `table()`

```{r}
tbl = table(data_copy$Meal)
print(tbl)
```

Pogledajmo kontingencijsku tablicu varijabli obroka i kategorija kupaca

```{r}
tbl = table(data_copy$Meal, data_copy$CustomerType)
tbl
```

Kontingencijskoj tablici možemo dodati i sume redaka i stupaca na sljedeći način.

```{r}
added_margins_tbl = addmargins(tbl)
print(added_margins_tbl)
```

Test nezavisnosti $\chi^2$ test u programskom paketu R implementiran je u funkciji `chisq.test()` koja kao ulaz prima kontingencijsku tablicu podataka koje testiramo na nezavisnost. Ispitajmo nezavisnost pozicije igrača na terenu i njegove preferirane noge za udarce.

Pretpostavka testa je da očekivana frekvencija pojedinog razreda mora biti veća ili jednaka 5 (`chisq.test()` pretpostavlja da je ovaj uvjet zadovoljen stoga je prije provođenja testa potrebno to provjeriti).

```{r}
for (col_names in colnames(added_margins_tbl)){
  for (row_names in rownames(added_margins_tbl)){
    if (!(row_names == 'Sum' | col_names == 'Sum') ){
      cat('Očekivane frekvencije za razred ',col_names,'-',row_names,': ',(added_margins_tbl[row_names,'Sum'] * added_margins_tbl['Sum',col_names]) / added_margins_tbl['Sum','Sum'],'\n')
    }
  }
}
```
Vidimo mogući problem:
"Očekivane frekvencije za razred  Group - FB        :  3.856655"

$\chi^2$ test zahtjeva frekvencije veće od 5, pa ćemo trebati izostaviti ovaj razred na neki način.
FB sadrži malen broj podataka, tako da bi mogao biti izostavljen potpuno.

Također smatramo da bi bilo dobro izostaviti varijable "Undefined" jer predstavljaju nepoznanicu koju je teško interpretirati.

Odluka je maknuti Undefined i FB iz kategorije Meals.

```{r}
cat("Kontingencijska tablica prije: \n")
table(data_copy$Meal)

cat("\n-----------------------------------\n")
data_modified <- data_copy[trimws(data_copy$Meal) != "Undefined" & trimws(data_copy$Meal) != "FB", ]

cat("Kontingencijska tablica poslije: \n")
table(data_modified$Meal)
```

Ponovimo prethodni postupak na data_modified

```{r}
tbl <- table(data_modified$Meal, data_modified$CustomerType)
tbl
```

```{r}
added_margins_tbl = addmargins(tbl)
added_margins_tbl
```
```{r}
for (col_names in colnames(added_margins_tbl)){
  for (row_names in rownames(added_margins_tbl)){
    if (!(row_names == 'Sum' | col_names == 'Sum') ){
      cat('Očekivane frekvencije za razred ',col_names,'-',row_names,': ',(added_margins_tbl[row_names,'Sum'] * added_margins_tbl['Sum',col_names]) / added_margins_tbl['Sum','Sum'],'\n')
    }
  }
}
```
Sada vidimo da su sve frekvencije zadovoljavajuće, te nemamo nepoznanica.
Možemo nastaviti sa $\chi^2$ testom.

```{r}
chisq.test(tbl,correct=F)
```
Na temelju vrlo male P-vrijednosti(p-value < 2.2e-16), odbacujemo H0 u korist H1 koja kaže da su vrsta obroka i kategorija gosta zavisni podaci.

\newpage

# Case study: OTKAZIVANJE REZERVACIJA

\newpage

# Case study: SKUPINE GOSTIJU IZ RAZLIČITIH ZEMALJA
